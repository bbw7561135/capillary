# Per implementare viscosità
## Perchè implementare viscosità
L'idea di implementare la viscosità nasce dal fatto che quando ho poca dens. di massa appena fuori dall'uscita del capillare, la simulazione si ferma perchè il calcolo della conduzione termica diventa instabile (secondo me a causa delle perturbazioni dovuti all'avvezione, combinato col fatto che k/cv sia molto elevato). Con un po' di viscosità forse si smorza un po' il gradiente di densità, perchè la viscosità dovrebbe smussare i gradienti e le oscillazioni di velocità e far avere un comportamento migliore alla fisica attorno agli shock. Oltretutto succede anche spesso che l'energia interna diventa negativa perchè l'energia cinetica è molto più grande della en.interna. Mentre con un po' di viscosità si potrebbe convertire un po' di en.cinetica in interna.
## Come
Si può sfruttare l'implementazione STS già presente in PLUTO, basta assicurarsi che sia compatibile con l'ADI.
Penso sia compatibile, solo che vanno aggiustati alcuni dettagli.
+ Se attivo la viscosità, dato che uso le coordinate cilindriche, devo stare attento a modificare correttamente il calcolo del rhs per togliere i termini sorgenti dovuti alla viscosità in coordinate curvilinee nel caso in cui scelgo di tenere bloccato il fluido; infatti sulla guida a pag 72 c'è scritto _"In curvilinear geometries, additional geometrical source terms coming from the tensor’s divergence are added to the right hand side of the equations."_.

Come implementare all'atto pratico:
+ Devo capire bene quali sono le equazioni che vengono risolte e come si normalizzano, perchè poi devo normalizzare la viscisità correnttamente. Comunque la viscisità deve avere dimensioni $\rho \times \mathrm{length}^2/\mathrm{time}$, vedi pag 73 della guida. Ricorda che per gas monoatomici $\nu_2=0$ (vedi la def. di $\nu_2$ sulla guida).
**Vedi il libro di Landau-Lifschitz(soprattutto pag 49), la guida di Pluto, l'NRL2016, Fundamentals of Gas Dynamics (in /home/ema/Dottorato/literature/teoria/gasdinamica/)**
+ Trovare e implementare un caso test per verificare che la viscosità funzioni bene.
+ Prima provare con una viscosità che sia realistica per l'idrogeno ma non accurata, se no rischio di perdere tempo con il coefficiente di visc. quando magari il codice è instabile o il limite sul dt per avanzamento STS è proibitivo.
+ Modificare le condizioni al contorno per $\vec v_\parallel$, perchè con viscosità servono anche quelle (non basta dire che v parallelo si riflette sulle celle ghost). Puoi usare la no-slip condition o altre condizioni (e.g. $v=\beta\frac{\partial v}{\partial n}$, vedi wikipedia: ``https://en.wikipedia.org/wiki/No-slip_condition``). Secondo me il fatto di mettere BCs che riducano la velocità tangente alle pareti del capillare può migliorare la stabilità del codice (meno perturbazioni che vengono dall'avvezione perchè $\vec v_\parallel$ è minore).

# Adimensionalizzazione della viscosità
Da un'analisi dell'equazione del momento mi risulta che la viscosità si dovrebbe adimensionalizzare con unità: $$\nu_u=\rho_u v_u x_u$$ con $$x_u=\mathrm{UNIT\_LENGTH}, \rho_u=\mathrm{UNIT\_DENSITY}, v_u=\mathrm{UNIT\_VELOCITY}$$. La conferma la trovo nei test problems di PLUTO.
Il test problem HD/Viscosity/Taylor_Couette ha in ``visc_nu.c``:
``*nu1 = g_inputParam[OMEGA]*rmin*(rmax - rmin)*v[RHO]/Re;``,
dove ``rmin`` e ``rmax`` sono adimensinoalizzati per $x_u$ (perchè sono presi dalle variabili globali che contengono le dimensioni del dominio e sono in unità adimensionali), ``v[RHO]`` è chiaramente adimensionalizzato, e ``Re``(numero di Reynolds) è adimensionale e non dipende dalla scelta delle unità. Anche $\Omega$ è adimensionale, lo vedi dal modo in cui in init.c (dello stesso test problem, alla riga 99) viene usato per impostare la velocità nella terza direzione.
Inoltre, notare che in PLUTO si chiama $\nu$ (``nu``) il coefficiente di viscosità dinamica mentre altrove, ad esempio in Landau-Lifshitz, $nu$ viene riservato alla viscosità cinematica. Sono sicuro che quella sia proprio la viscosità dinamica, appunto, per le unità adimensionalizzanti utilizzate e per l'espressione che danno del tensore degli sforzi viscosi nel manuale di PLUTO, che usa $\nu$ in luogo della viscosità dinamica.
